  [1m[36m (6.3ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.5ms)[0m  [1mbegin transaction[0m
--------------------------------
Petrie::PageTest: test_has_title
--------------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.5ms)[0m  [1mbegin transaction[0m
--------------------------------
Petrie::PageTest: test_has_title
--------------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.5ms)[0m  [1mbegin transaction[0m
--------------------------------
Petrie::PageTest: test_has_title
--------------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.5ms)[0m  [1mbegin transaction[0m
--------------------------------
Petrie::PageTest: test_has_title
--------------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
--------------------------------
Petrie::PageTest: test_has_title
--------------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#nerp
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (6.5ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.5ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (4.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "title", "updated_at") VALUES (?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:29:21 UTC +00:00], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:29:21 UTC +00:00]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (3.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "title", "updated_at") VALUES (?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:30:11 UTC +00:00], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:30:11 UTC +00:00]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (3.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "title", "updated_at") VALUES (?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:30:37 UTC +00:00], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:30:37 UTC +00:00]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (3.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:31:01 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:31:01 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (3.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:32:34 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:32:34 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:32:34 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:32:34 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["updated_at", Sat, 02 Nov 2013 23:32:34 UTC +00:00]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (1.3ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (3.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:32:52 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:32:52 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:32:52 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:32:52 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:32:52 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (3.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:37:15 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:37:15 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:37:15 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:37:15 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (1.0ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:37:15 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:37:15 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:37:15 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (3.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:37:38 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:37:38 UTC +00:00]]
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.3ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:37:38 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:37:38 UTC +00:00]]
  [1m[36m (0.2ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mSQL (0.7ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["updated_at", Sat, 02 Nov 2013 23:37:39 UTC +00:00]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (1.2ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "slug", "title", "updated_at") VALUES (?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:37:39 UTC +00:00], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:37:39 UTC +00:00]]
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.2ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36m (0.1ms)[0m  [1mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35m (0.1ms)[0m  ROLLBACK TO SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.7ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.2ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.7ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:39:35 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:39:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:39:35 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:39:35 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.7ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:39:35 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:39:35 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:39:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (3.2ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:42:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:42:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.3ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:42:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:42:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.5ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.8ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:42:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.8ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:42:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:42:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.8ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.2ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
------------------------------------
Petrie::PageTest: test_#top_ancestor
------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.7ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:44:41 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
------------------------------------
Petrie::PageTest: test_#top_ancestor
------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.8ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (1.1ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:46:02 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.2ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (1.0ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
------------------------------------
Petrie::PageTest: test_#top_ancestor
------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.8ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.4ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:47:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
------------------------------------
Petrie::PageTest: test_#top_ancestor
------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.0ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.7ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.6ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:47:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------
PetrieTest: test_truth
----------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.6ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.2ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
------------------------------------
Petrie::PageTest: test_#top_ancestor
------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.6ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:48:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.8ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.1ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
------------------------------------
Petrie::PageTest: test_#top_ancestor
------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.7ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sat, 02 Nov 2013 23:48:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.7ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#body
----------------------------
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------
Petrie::PageTest: test_#slug
----------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
-----------------------------
Petrie::PageTest: test_#title
-----------------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
------------------------------------
Petrie::PageTest: test_#top_ancestor
------------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
----------------------------------------------------
Petrie::PageTest: test_generates_new_slug_if_changes
----------------------------------------------------
  [1m[35m (0.1ms)[0m  SAVEPOINT active_record_1
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.0ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  RELEASE SAVEPOINT active_record_1
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
---------------------------------
Petrie::PageTest: test_nested_set
---------------------------------
  [1m[36m (0.1ms)[0m  [1mSAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 00:02:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mRELEASE SAVEPOINT active_record_1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
----------------------
PetrieTest: test_truth
----------------------
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.9ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 00:30:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 00:30:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.8ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "test-page-d8748021-e496-4a20-8017-5f5b5076d9e5"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.6ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 2  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.6ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00], ["lft", 5], ["rgt", 6], ["slug", "test-page-a4bafdaa-7e89-4536-a5dc-9fed394df788"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (1.3ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00], ["lft", 7], ["rgt", 8], ["slug", "test-page-028f5183-0728-417f-95ae-59b27aec363a"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.6ms)[0m  [1mcommit transaction[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00], ["lft", 9], ["rgt", 10], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00], ["lft", 11], ["parent_id", 5], ["rgt", 12], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 00:31:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 5]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 10 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 10 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 10 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 10 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 5 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 10 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 10 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 10 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 10 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 5 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 10 AND "petrie_pages"."rgt" >= 11) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 10 AND "petrie_pages"."rgt" >= 11) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 10 AND "petrie_pages"."lft" < 11) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 10 AND "petrie_pages"."rgt" >= 11) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 10 AND "petrie_pages"."rgt" >= 11) AND ("petrie_pages".id != 6)[0m
  [1m[35m (0.7ms)[0m  commit transaction
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.9ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00], ["lft", 13], ["rgt", 14], ["slug", "test-page-0dad570b-c659-4748-843d-48b1e65e43f9"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.9ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 7  [["title", "Buster"], ["slug", "buster-501a9bf3-f129-45ad-bffc-9c6d0c274cfc"], ["updated_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00], ["lft", 15], ["rgt", 16], ["slug", "test-page-871ae666-00e9-4702-86a3-e165531a3af9"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 8]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 8 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.7ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00], ["lft", 17], ["rgt", 18], ["slug", "test-page-3d4f95dd-e9a9-4266-807b-c5e2a86ea57b"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 9]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 9 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00], ["lft", 19], ["rgt", 20], ["slug", "parent-page-e5262eab-a86c-439e-8187-b29a1846479b"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 10]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 10 ORDER BY "petrie_pages"."lft")
  [1m[36m (1.5ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00], ["lft", 21], ["parent_id", 10], ["rgt", 22], ["slug", "child-page-0ef46fb5-bab2-48c4-9b45-3a3b04e5dd42"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 04:46:51 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 10]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 11]]
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END, "parent_id" = CASE WHEN id = 11 THEN 10 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 20 AND 20 THEN "lft" + 22 - 20 WHEN "lft" BETWEEN 21 AND 22 THEN "lft" + 20 - 21 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 20 AND 20 THEN "rgt" + 22 - 20 WHEN "rgt" BETWEEN 21 AND 22 THEN "rgt" + 20 - 21 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 11 THEN 10 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 10]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 11]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 20 AND "petrie_pages"."rgt" >= 21) AND ("petrie_pages".id != 11)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 11 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 20 AND "petrie_pages"."rgt" >= 21) AND ("petrie_pages".id != 11)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 20 AND "petrie_pages"."lft" < 21) AND ("petrie_pages".id != 11) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 11]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 11]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 20 AND "petrie_pages"."rgt" >= 21) AND ("petrie_pages".id != 11)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 11 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 20 AND "petrie_pages"."rgt" >= 21) AND ("petrie_pages".id != 11)[0m
  [1m[35m (0.8ms)[0m  commit transaction
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 10]]
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.0ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00], ["lft", 23], ["rgt", 24], ["slug", "test-page-aff2ff7f-dfb0-4954-a33f-cf9b640cc8ae"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 12]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 12 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 12  [["title", "Buster"], ["slug", "buster-e176d5ac-c01f-483d-aeed-68e2b55dee4d"], ["updated_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 12]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 12 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00], ["lft", 25], ["rgt", 26], ["slug", "test-page-89a81ee0-3a84-4bf9-afb5-0b82ac4c37c0"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 13]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 13 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.9ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00], ["lft", 27], ["rgt", 28], ["slug", "test-page-6a90ff18-f03f-4534-8e01-866e5865ddc8"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 14]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 14 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[35mPetrie::Page Load (0.4ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00], ["lft", 29], ["rgt", 30], ["slug", "parent-page-730fcbee-de47-4127-a92f-27a5ab4a0037"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 15]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 15 ORDER BY "petrie_pages"."lft")
  [1m[36m (1.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00], ["lft", 31], ["parent_id", 15], ["rgt", 32], ["slug", "child-page-7b383565-f130-4e47-a8bc-e593c49fdfcc"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 04:54:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 15]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 16]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 30 AND 30 THEN "lft" + 32 - 30 WHEN "lft" BETWEEN 31 AND 32 THEN "lft" + 30 - 31 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 30 AND 30 THEN "rgt" + 32 - 30 WHEN "rgt" BETWEEN 31 AND 32 THEN "rgt" + 30 - 31 ELSE "rgt" END, "parent_id" = CASE WHEN id = 16 THEN 15 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 30 AND 30 THEN "lft" + 32 - 30 WHEN "lft" BETWEEN 31 AND 32 THEN "lft" + 30 - 31 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 30 AND 30 THEN "rgt" + 32 - 30 WHEN "rgt" BETWEEN 31 AND 32 THEN "rgt" + 30 - 31 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 16 THEN 15 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 15]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 16]]
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 30 AND "petrie_pages"."rgt" >= 31) AND ("petrie_pages".id != 16)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 16 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 30 AND "petrie_pages"."rgt" >= 31) AND ("petrie_pages".id != 16)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 30 AND "petrie_pages"."lft" < 31) AND ("petrie_pages".id != 16) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 16]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 16]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 30 AND "petrie_pages"."rgt" >= 31) AND ("petrie_pages".id != 16)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 16 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 30 AND "petrie_pages"."rgt" >= 31) AND ("petrie_pages".id != 16)[0m
  [1m[35m (0.8ms)[0m  commit transaction
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 15]]
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.6ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (5.1ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:04:28 UTC +00:00], ["lft", 33], ["rgt", 34], ["slug", "test"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:04:28 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 17]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 17 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.8ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:06:36 UTC +00:00], ["lft", 35], ["rgt", 36], ["slug", "test-538df4ae-b3c4-47ce-9c4c-bdde87ad5d3e"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:06:36 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 18]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 18 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.0ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:06:53 UTC +00:00], ["lft", 37], ["rgt", 38], ["slug", "test-2c4b2138-7ee4-4f79-9775-3fb976495c7d"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:06:53 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 19]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 19 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:07:10 UTC +00:00], ["lft", 39], ["rgt", 40], ["slug", "test-74ff8747-3681-4196-8bf1-b2e21f66b436"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:07:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 20]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 20 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.9ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:08:07 UTC +00:00], ["lft", 41], ["rgt", 42], ["slug", "test-1b3ade9a-9ec9-43b5-96f4-140d95a1c7a0"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:08:07 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 21]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 21 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.6ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (8.0ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:09:50 UTC +00:00], ["lft", 43], ["rgt", 44], ["slug", "test-97557023-fd43-4bcd-8ee5-611114273cb7"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:09:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 22]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 22 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.9ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.9ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:10:49 UTC +00:00], ["lft", 45], ["rgt", 46], ["slug", "test-f7fcac7a-2475-4d58-8fee-1c7306d190fc"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:10:49 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 23]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 23 ORDER BY "petrie_pages"."lft")
  [1m[36m (3.9ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.6ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.9ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:12:25 UTC +00:00], ["lft", 47], ["rgt", 48], ["slug", "test-ac890033-e4ce-4fd3-a5d1-9c3a2bea2cc8"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:12:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 24]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 24 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.6ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:14:19 UTC +00:00], ["lft", 49], ["rgt", 50], ["slug", "test-148449d5-ecd3-4c95-91a1-d249b937b554"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:14:19 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 25]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 25 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.2ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.6ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:15:48 UTC +00:00], ["lft", 51], ["rgt", 52], ["slug", "test-1d4fba1f-682b-4b6b-9138-2b27c85338bf"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:15:48 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 26]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 26 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.0ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:19:01 UTC +00:00], ["lft", 53], ["rgt", 54], ["slug", "test-1503384e-f430-4fdd-b65e-326441ef04ac"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:19:01 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 27]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 27 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.9ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:21:36 UTC +00:00], ["lft", 55], ["rgt", 56], ["slug", "test-d4f1686c-e464-4733-beb4-986ea001f8d9"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:21:36 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 28]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 28 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.2ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:22:14 UTC +00:00], ["lft", 57], ["rgt", 58], ["slug", "test-84027e87-20e1-475c-a271-30c7192501cb"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:22:14 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 29]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 29 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"test"}
Completed 500 Internal Server Error in 10ms
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:22:31 UTC +00:00], ["lft", 59], ["rgt", 60], ["slug", "test-9ee7fb82-4fee-4dc2-80de-d556b211e29e"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:22:31 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 30]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 30 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:23:21 UTC +00:00], ["lft", 61], ["rgt", 62], ["slug", "test-b430c524-be88-46f8-ae0f-64c7c4e3613b"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:23:21 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 31]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 31 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.9ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:24:19 UTC +00:00], ["lft", 63], ["rgt", 64], ["slug", "test-76746615-c873-4ac2-bb81-158e8b9eabdf"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:24:19 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 32]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 32 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.9ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:24:26 UTC +00:00], ["lft", 65], ["rgt", 66], ["slug", "test-20ef481a-0b3c-4ece-8d2e-e02c71f75fb6"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:24:26 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 33]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 33 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.0ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:26:01 UTC +00:00], ["lft", 67], ["rgt", 68], ["slug", "test-7c830b4b-8ede-4fff-af5a-0e1c2cb26819"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:26:01 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 34]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 34 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"test"}
Completed 500 Internal Server Error in 8ms
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:26:21 UTC +00:00], ["lft", 69], ["rgt", 70], ["slug", "test-be374258-5e5f-4b6f-9c11-04896ba95fa6"], ["title", "test"], ["updated_at", Sun, 03 Nov 2013 05:26:21 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 35]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 35 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"test"}
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.7ms)
Completed 200 OK in 11ms (Views: 10.6ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (3.8ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:27:12 UTC +00:00], ["lft", 71], ["rgt", 72], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:27:12 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 36]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 36 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.8ms)[0m  [1mcommit transaction[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 10ms (Views: 9.4ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.0ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:27:43 UTC +00:00], ["lft", 73], ["rgt", 74], ["slug", "about-e2fa865e-dcae-42a7-8557-b3d56419b7ef"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:27:43 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 37]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 37 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 11ms (Views: 9.2ms | ActiveRecord: 0.3ms)
  [1m[36m (0.2ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (4.2ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:28:25 UTC +00:00], ["lft", 75], ["rgt", 76], ["slug", "about-cce840cf-70f2-4dc9-aea9-9384e08686a2"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:28:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 38]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 38 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.7ms)[0m  [1mcommit transaction[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (2.9ms)
Completed 200 OK in 14ms (Views: 11.7ms | ActiveRecord: 0.3ms)
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.7ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:30:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:30:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 12ms (Views: 10.1ms | ActiveRecord: 0.2ms)
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.1ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:30:50 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:30:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 11ms (Views: 9.1ms | ActiveRecord: 0.2ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:33:33 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:33:33 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 12ms (Views: 10.1ms | ActiveRecord: 0.2ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Processing by Petrie::PagesController#home as HTML
  Parameters: {"page"=>"home"}
Completed 500 Internal Server Error in 10ms
  [1m[36m (0.2ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.5ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:33:50 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:33:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 7ms (Views: 5.4ms | ActiveRecord: 0.2ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Processing by Petrie::PagesController#home as HTML
  Parameters: {"page"=>"home"}
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/home.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 10ms (Views: 9.3ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:34:09 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:34:09 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 5ms (Views: 2.6ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.6ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.3ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Processing by Petrie::PagesController#home as HTML
  Parameters: {"page"=>"home"}
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/home.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 11ms (Views: 10.7ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (7.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:38:42 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:38:42 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 5ms (Views: 3.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Processing by Petrie::PagesController#home as HTML
  Parameters: {"page"=>"home"}
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/home.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 10ms (Views: 9.4ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:40:03 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:40:03 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 5ms (Views: 3.1ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:41:19 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:41:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.8ms)
Completed 200 OK in 13ms (Views: 10.5ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Processing by Petrie::PagesController#home as HTML
Completed 200 OK in 3ms (Views: 2.5ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.5ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Processing by Petrie::PagesController#/home as HTML
  Parameters: {"page"=>"home"}
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/home.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 10ms (Views: 9.3ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:42:55 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:42:55 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 5ms (Views: 2.9ms | ActiveRecord: 0.2ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:43:51 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:43:51 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 12ms (Views: 9.8ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Processing by Petrie::PagesController#home as HTML
  Parameters: {"page"=>"home"}
Completed 200 OK in 3ms (Views: 2.4ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (8.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:44:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:44:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 13ms (Views: 10.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Processing by Petrie::PagesController#home as HTML
  Parameters: {"page"=>"home"}
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/home.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 10ms (Views: 9.2ms | ActiveRecord: 0.0ms)
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:44:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:44:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 5ms (Views: 3.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 00:47:16 -0500
  [1m[36m (0.2ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 05:47:22 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.8ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:47:23 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:47:23 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 12ms (Views: 9.9ms | ActiveRecord: 0.2ms)
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
Started GET "/home" for 127.0.0.1 at 2013-11-03 00:47:23 -0500
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.2ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"motorcycles"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 12ms (Views: 9.6ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:53:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 3ms (Views: 1.3ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 00:53:20 -0500
  [1m[36m (0.2ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 12ms (Views: 9.5ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda/motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 2ms
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.6ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'buster' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.0ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 05:53:42 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1  [["id", 1]]
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 00:53:42 -0500
  [1m[36m (0.2ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:54:22 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:54:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (2.5ms)
Completed 200 OK in 15ms (Views: 12.5ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.6ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:54:22 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 05:54:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:54:22 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 05:54:22 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda/motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 2ms
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (2.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.3ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:54:59 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:54:59 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 12ms (Views: 9.7ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:54:59 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 05:54:59 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:54:59 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 05:54:59 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda/motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 2ms
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:55:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:55:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 13ms (Views: 10.7ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:55:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 05:55:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:55:06 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 05:55:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 3ms (Views: 1.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 05:57:26 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 05:57:26 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:57:26 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 05:57:26 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 12ms (Views: 10.0ms | ActiveRecord: 0.2ms)
  [1m[35m (0.6ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (1.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 05:57:26 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 05:57:26 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 3ms (Views: 1.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 00:57:31 -0500
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 00:57:31 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 00:59:04 -0500
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 00:59:04 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 20ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 00:59:32 -0500
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 00:59:32 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 20ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 01:00:37 -0500
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:00:37 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 21ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 01:01:33 -0500
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:01:33 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:02:43 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 20ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
Started GET "/home" for 127.0.0.1 at 2013-11-03 01:02:44 -0500
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.5ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:02:58 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
Started GET "/home" for 127.0.0.1 at 2013-11-03 01:02:58 -0500
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:03:20 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 20ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:05:32 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:06:55 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 21ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:07:37 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:09:21 -0500
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:10:22 -0500
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:10:45 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:11:29 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.0ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:11:43 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:12:07 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:12:18 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:14:49 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:15:18 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:16:32 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 21ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/nerp" for 127.0.0.1 at 2013-11-03 01:17:30 -0500
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 21ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:18:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 06:18:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 12ms (Views: 9.8ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (1.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:18:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 06:18:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:18:46 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 06:18:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 4ms (Views: 1.4ms | ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.2ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 21ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.4ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.0ms)[0m  begin transaction
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 20ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"nerp"}
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nerp' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 404 Not Found in 19ms
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:27:57 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:27:57 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:27:57 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:27:57 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:27:58 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:27:58 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:27:58 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:27:58 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:27:58 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-119ec73c-05c6-48e4-a985-e2be1809fa44"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:27:58 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 12ms (Views: 9.6ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-0c05af07-0d04-410f-9213-4e54b1132af2"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:28:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 12ms (Views: 9.8ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-4eee9bf8-0240-4e51-ac0b-1f21263e58fe"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:30:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 12ms (Views: 9.3ms | ActiveRecord: 0.2ms)
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.2ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:30:44 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:30:44 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:30:44 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:30:44 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:30:44 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:30:44 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:30:44 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:30:44 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:30:45 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-12ea4b88-8446-428b-b291-e8af09c0e7d5"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:30:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 12ms (Views: 9.7ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:31:12 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:31:12 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:31:12 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:31:12 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:31:13 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:31:13 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:31:13 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:31:13 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs-petrie-page-0x007f818e0259d8' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:31:13 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-petrie-page-0x007f818e0259d8"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:31:13 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 13ms (Views: 10.4ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.4ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= NULL AND "petrie_pages"."rgt" >= NULL) AND ("petrie_pages".id != NULL) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-01efc115-b88a-4ecf-8d48-0fa6436b55bf"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:33:39 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (2.4ms)
Completed 200 OK in 15ms (Views: 12.4ms | ActiveRecord: 0.2ms)
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (1.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs-activerecord-relation-activerecord_relation_petrie_page-0x007fa96dd8c070' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-activerecord-relation-activerecord_relation_petrie_page-0x007fa96dd8c070"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:33:49 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[36mPetrie::Page Load (0.5ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (6.2ms)
Completed 200 OK in 19ms (Views: 16.8ms | ActiveRecord: 0.5ms)
  [1m[35m (0.7ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.6ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.7ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:34:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:34:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:34:06 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:34:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:34:07 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:34:07 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:34:07 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:34:07 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= NULL AND "petrie_pages"."rgt" >= NULL) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = '' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:34:07 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", ""], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:34:07 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 12ms (Views: 10.1ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.6ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.5ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= NULL AND "petrie_pages"."rgt" >= NULL) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = '' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", ""], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:35:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 12ms (Views: 9.7ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.3ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= NULL AND "petrie_pages"."rgt" >= NULL) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = '' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", ""], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:35:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 12ms (Views: 9.5ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (14.7ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.3ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.6ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:41:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:41:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:41:45 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:41:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:41:45 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:41:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:41:45 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:41:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs-petrie-page-0x007fd653765940' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:41:46 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-petrie-page-0x007fd653765940"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:41:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 13ms (Views: 10.2ms | ActiveRecord: 0.2ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.1ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs-nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-nashville"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:43:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (2.0ms)
Completed 200 OK in 15ms (Views: 12.4ms | ActiveRecord: 0.2ms)
  [1m[36m (1.0ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:49:27 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:49:27 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:49:27 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:49:27 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:49:27 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:49:27 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:49:28 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:49:28 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:49:28 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:49:28 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.9ms)
Completed 200 OK in 15ms (Views: 11.9ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.2ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:49:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:49:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:49:56 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:49:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:49:56 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:49:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:49:56 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:49:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:49:57 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:49:57 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 12ms (Views: 9.6ms | ActiveRecord: 0.2ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."title" = 'locations' AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."title" = 'chicago' AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."title" = 'nashville' AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."title" = 'jobs' AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."title" = 'jobs' AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs-a3a73022-0123-449e-99f8-1ae4e82caf16"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 06:51:12 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 11ms (Views: 9.1ms | ActiveRecord: 0.2ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.5ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:00:17 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 500 Internal Server Error in 3ms
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:01:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 500 Internal Server Error in 3ms
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:04:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 5ms
  [1m[35m (0.6ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.1ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:04:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.6ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.8ms)
Completed 200 OK in 17ms (Views: 12.1ms | ActiveRecord: 0.9ms)
  [1m[36m (0.7ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.6ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:05:17 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.7ms)
Completed 200 OK in 16ms (Views: 11.1ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:05:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 15ms (Views: 9.8ms | ActiveRecord: 0.6ms)
  [1m[35m (0.6ms)[0m  rollback transaction
  [1m[36m (1.6ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:06:13 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 14ms (Views: 9.7ms | ActiveRecord: 0.5ms)
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:06:40 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:06:40 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:06:40 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:06:40 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:06:41 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:06:41 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:06:41 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:06:41 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (1.4ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:06:41 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:06:41 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 16ms (Views: 10.3ms | ActiveRecord: 0.7ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00], ["lft", 7], ["parent_id", 2], ["rgt", 8], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 3 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 3 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00], ["lft", 9], ["parent_id", 3], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:07:24 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 7 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 7 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 5)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 15ms (Views: 10.4ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:08:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.5ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/nashville/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 14ms (Views: 9.1ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.1ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.5ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:09:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 14ms (Views: 9.4ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.3ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.2ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:09:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 2]]
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 23ms (Views: 11.1ms | ActiveRecord: 0.8ms)
  [1m[35m (1.0ms)[0m  rollback transaction
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:22 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:11:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:22 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:11:22 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
Completed 500 Internal Server Error in 5ms
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:11:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:37 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:11:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:37 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:11:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:37 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:11:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:38 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:38 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:38 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
Completed 500 Internal Server Error in 5ms
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.3ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (5.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (56.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.5ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:11:50 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.5ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
Completed 500 Internal Server Error in 5ms
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.5ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:12:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:12:07 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:12:07 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:12:07 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:12:07 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 2]]
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 21ms (Views: 9.6ms | ActiveRecord: 0.8ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.3ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:14:30 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.6ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:14:31 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:14:31 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:14:31 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:14:31 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 15ms (Views: 9.1ms | ActiveRecord: 0.7ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:15:27 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:15:28 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:15:28 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:15:28 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:15:28 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
Completed 500 Internal Server Error in 2ms
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:17:08 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:17:08 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:17:08 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:17:08 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.4ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:17:09 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
Completed 500 Internal Server Error in 2ms
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (1.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:17:22 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
Completed 500 Internal Server Error in 2ms
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:19:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 2]]
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 22ms (Views: 10.0ms | ActiveRecord: 0.7ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:19:49 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 14ms (Views: 9.0ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:20:31 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:20:31 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:20:31 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:20:31 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:20:31 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:20:31 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:20:32 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:20:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:20:32 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:20:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:20:32 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:20:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:20:32 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:20:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 14ms (Views: 9.7ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:20:52 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 15ms (Views: 9.8ms | ActiveRecord: 0.6ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:22:03 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 15ms (Views: 10.0ms | ActiveRecord: 0.6ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.4ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:22:42 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:22:42 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:22:43 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 14ms (Views: 9.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:25:54 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:25:54 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:25:54 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:25:54 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:25:54 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:25:54 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:25:54 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:25:54 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:25:55 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:25:55 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:25:55 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:25:55 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:25:55 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:25:55 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.7ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 15ms (Views: 10.4ms | ActiveRecord: 1.1ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:26:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 13ms (Views: 9.5ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:27:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 14ms (Views: 10.1ms | ActiveRecord: 0.6ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:28:04 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.7ms)
Completed 200 OK in 14ms (Views: 9.8ms | ActiveRecord: 0.5ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.7ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.8ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:28:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 13ms (Views: 9.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.2ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:29:04 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:29:05 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:29:05 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 13ms (Views: 9.0ms | ActiveRecord: 0.5ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.1ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:30:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 13ms (Views: 9.3ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.6ms)
Completed 200 OK in 14ms (Views: 9.6ms | ActiveRecord: 0.6ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
Completed 200 OK in 3ms (Views: 1.3ms | ActiveRecord: 0.2ms)
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 07:30:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'
Completed 200 OK in 3ms (Views: 1.4ms | ActiveRecord: 0.2ms)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (1.8ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.4ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:20 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:20 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 13ms (Views: 9.3ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.3ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.4ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 13ms (Views: 9.1ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (1.2ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.9ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.9ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:31:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 13ms (Views: 9.5ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.2ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:32:04 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:32:04 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:32:04 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:32:04 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:32:05 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 14ms (Views: 9.2ms | ActiveRecord: 0.6ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.5ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:32:14 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 13ms (Views: 9.1ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:33:09 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:10 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:33:10 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:10 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:33:10 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 13ms (Views: 9.1ms | ActiveRecord: 0.5ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.5ms)
Completed 200 OK in 13ms (Views: 10.6ms | ActiveRecord: 0.2ms)
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'
Completed 200 OK in 3ms (Views: 1.3ms | ActiveRecord: 0.2ms)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1
  [1m[36mPetrie::Page Load (0.5ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.4ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.9ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:33:18 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:19 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:33:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:19 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:33:19 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
Completed 200 OK in 6ms (Views: 1.9ms | ActiveRecord: 0.5ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:33:58 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 07:33:58 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:33:58 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 07:33:58 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (2.0ms)
Completed 200 OK in 13ms (Views: 10.9ms | ActiveRecord: 0.2ms)
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.6ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 07:35:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:20 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 07:35:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 70ms (Views: 9.7ms | ActiveRecord: 0.4ms)
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 6ms
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 13ms (Views: 9.5ms | ActiveRecord: 0.5ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 07:35:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 4ms (Views: 1.3ms | ActiveRecord: 0.3ms)
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.4ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:35 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 5ms
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:35:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:46 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:35:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:46 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:35:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.5ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:46 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:35:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:47 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:47 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:35:47 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:47 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:35:47 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:35:47 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.6ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 7ms
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:36:25 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 6ms
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:36:54 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:36:54 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:36:54 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:36:54 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:36:55 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 6ms
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:37:48 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 6ms
  [1m[35m (0.3ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (55.6ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.4ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:38:24 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'locations' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 500 Internal Server Error in 6ms
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (1.6ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:53 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:38:53 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:53 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:38:53 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.5ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:53 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:38:53 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:54 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:38:54 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:54 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:38:54 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:54 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:38:54 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:54 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:38:54 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.3ms)
Completed 200 OK in 13ms (Views: 9.2ms | ActiveRecord: 0.5ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00], ["lft", 3], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (2.1ms)
Completed 200 OK in 15ms (Views: 11.7ms | ActiveRecord: 0.4ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 57ms (Views: 54.7ms | ActiveRecord: 0.4ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.2ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:38:59 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:39:00 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:39:00 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:39:00 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:39:00 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:39:00 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:39:00 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
Completed 200 OK in 6ms (Views: 1.4ms | ActiveRecord: 0.6ms)
  [1m[35m (0.6ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:43:27 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 07:43:27 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:43:27 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 07:43:27 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:43:40 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 07:43:40 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:43:40 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 07:43:40 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.8ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.4ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:45:43 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 07:45:43 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:45:43 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 07:45:43 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:46:06 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 07:46:06 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:46:06 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 07:46:06 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:46:23 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 07:46:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:46:23 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 07:46:23 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.5ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.3ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:46:34 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 07:46:34 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:46:34 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 07:46:34 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:49:38 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 07:49:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:49:38 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 07:49:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:50:08 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 07:50:08 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (1.8ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:50:08 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 07:50:08 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:54:19 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 07:54:19 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.4ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 13ms (Views: 9.3ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.3ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 4ms (Views: 1.3ms | ActiveRecord: 0.3ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 4ms (Views: 1.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 07:54:20 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 4ms (Views: 1.5ms | ActiveRecord: 0.3ms)
  [1m[36m (0.7ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.1ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.6ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[36m (1.6ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:01:15 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:01:15 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:01:32 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:01:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:02:14 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:02:14 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:23 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:03:23 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.6ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:23 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:03:23 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:32 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:03:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:32 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:03:32 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:32 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "honda"], ["title", "Honda"], ["updated_at", Sun, 03 Nov 2013 08:03:32 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = ? ORDER BY lft  [["parent_id", 1]]
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[36m (1.0ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.1ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 02:03:37 -0600
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'buster' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.2ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (1.0ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'honda' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "honda"], ["title", "Honda"], ["updated_at", Sun, 03 Nov 2013 08:03:37 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = ? ORDER BY lft[0m  [["parent_id", 1]]
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
Completed 200 OK in 12ms (Views: 8.2ms | ActiveRecord: 0.5ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.6ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 4ms (Views: 1.3ms | ActiveRecord: 0.3ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 08:03:38 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 5ms (Views: 1.9ms | ActiveRecord: 0.3ms)
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (4.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'buster' LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1[0m  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (1.0ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.7ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (1.0ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.5ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m  [["id", 1]]
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "honda"], ["title", "Honda"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.4ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = ? ORDER BY lft  [["parent_id", 1]]
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
Started GET "/home" for 127.0.0.1 at 2013-11-03 10:51:56 -0600
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 13ms (Views: 9.8ms | ActiveRecord: 0.4ms)
  [1m[36m (0.6ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.2ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.8ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.5ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 4ms (Views: 1.6ms | ActiveRecord: 0.4ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.4ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.3ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:51:56 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'
Completed 200 OK in 5ms (Views: 1.3ms | ActiveRecord: 0.5ms)
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.7ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:15 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 16:54:15 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
  Rendered /Users/nic/code/petrie/app/views/petrie/pages/show.html.erb within layouts/petrie/application (1.4ms)
Completed 200 OK in 13ms (Views: 9.5ms | ActiveRecord: 0.4ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.7ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 5ms (Views: 1.3ms | ActiveRecord: 0.4ms)
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Exists (0.1ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
Completed 200 OK in 5ms (Views: 1.5ms | ActiveRecord: 0.5ms)
  [1m[35m (0.6ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.4ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (1.0ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'honda' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "honda"], ["title", "Honda"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = ? ORDER BY lft[0m  [["parent_id", 1]]
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:54:16 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:54:17 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 16:54:17 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:54:17 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 16:54:17 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1  [["id", 1]]
  [1m[36m (0.7ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 10:54:17 -0600
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[36m (0.9ms)[0m  [1mDELETE FROM "petrie_pages";[0m
  [1m[35m (0.2ms)[0m  SELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';
  [1m[36m (0.2ms)[0m  [1mDELETE FROM sqlite_sequence where name = 'petrie_pages';[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (3.9ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "motorcycles"], ["title", "Motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "honda"], ["title", "Honda"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.3ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = ? ORDER BY lft  [["parent_id", 1]]
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'honda' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.8ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "honda"], ["title", "honda"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'motorcycles' LIMIT 1
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "motorcycles"], ["title", "motorcycles"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mPetrie::Page Load (0.3ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"honda/motorcycles"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'motorcycles' ORDER BY "petrie_pages"."id" ASC LIMIT 1
Completed 200 OK in 11ms (Views: 8.5ms | ActiveRecord: 0.3ms)
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'about' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.5ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "about"], ["title", "about"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (1.0ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"about"}
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about'
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'about' ORDER BY "petrie_pages"."id" ASC LIMIT 1[0m
Completed 200 OK in 4ms (Views: 1.4ms | ActiveRecord: 0.3ms)
  [1m[35m (0.7ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'locations' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.6ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "locations"], ["title", "locations"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'chicago' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.2ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "chicago"], ["title", "chicago"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'nashville' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 5], ["parent_id", 1], ["rgt", 6], ["slug", "nashville"], ["title", "nashville"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END, "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 4 AND 4 THEN "lft" + 6 - 4 WHEN "lft" BETWEEN 5 AND 6 THEN "lft" + 4 - 5 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 4 AND 4 THEN "rgt" + 6 - 4 WHEN "rgt" BETWEEN 5 AND 6 THEN "rgt" + 4 - 5 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 3 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 4 AND "petrie_pages"."lft" < 5) AND ("petrie_pages".id != 3) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 3 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 4 AND "petrie_pages"."rgt" >= 5) AND ("petrie_pages".id != 3)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'new-york' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 7], ["parent_id", 1], ["rgt", 8], ["slug", "new-york"], ["title", "new york"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END, "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 6 AND 6 THEN "lft" + 8 - 6 WHEN "lft" BETWEEN 7 AND 8 THEN "lft" + 6 - 7 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 6 AND 6 THEN "rgt" + 8 - 6 WHEN "rgt" BETWEEN 7 AND 8 THEN "rgt" + 6 - 7 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 4 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 6 AND "petrie_pages"."lft" < 7) AND ("petrie_pages".id != 4) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 4 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 6 AND "petrie_pages"."rgt" >= 7) AND ("petrie_pages".id != 4)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 2 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 9], ["parent_id", 2], ["rgt", 10], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END, "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 3 AND 8 THEN "lft" + 10 - 8 WHEN "lft" BETWEEN 9 AND 10 THEN "lft" + 3 - 9 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 3 AND 8 THEN "rgt" + 10 - 8 WHEN "rgt" BETWEEN 9 AND 10 THEN "rgt" + 3 - 9 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 5 THEN 2 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 3 AND "petrie_pages"."lft" < 4) AND ("petrie_pages".id != 5) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 5]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 5]]
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 5 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 3 AND "petrie_pages"."rgt" >= 4) AND ("petrie_pages".id != 5)
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 3 AND "petrie_pages"."slug" = 'jobs' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 11], ["parent_id", 3], ["rgt", 12], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 3]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mSQL (0.4ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END, "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 7 AND 10 THEN "lft" + 12 - 10 WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 7 - 11 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 7 AND 10 THEN "rgt" + 12 - 10 WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 7 - 11 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 6 THEN 3 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 3]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 7 AND "petrie_pages"."lft" < 8) AND ("petrie_pages".id != 6) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 6]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 6]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 6 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 7 AND "petrie_pages"."rgt" >= 8) AND ("petrie_pages".id != 6)[0m
  [1m[35mPetrie::Page Exists (0.2ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 4 AND "petrie_pages"."slug" = 'jobs' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.3ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 13], ["parent_id", 4], ["rgt", 14], ["slug", "jobs"], ["title", "jobs"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1[0m  [["id", 4]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mSQL (0.3ms)[0m  [1mUPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END, "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 11 AND 12 THEN "lft" + 14 - 12 WHEN "lft" BETWEEN 13 AND 14 THEN "lft" + 11 - 13 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 11 AND 12 THEN "rgt" + 14 - 12 WHEN "rgt" BETWEEN 13 AND 14 THEN "rgt" + 11 - 13 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 7 THEN 4 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 4]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 11 AND "petrie_pages"."lft" < 12) AND ("petrie_pages".id != 7) ORDER BY "petrie_pages"."lft"[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 7]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 7]]
  [1m[35m (0.2ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
  [1m[36mSQL (0.1ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 2 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 7 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.1ms)[0m  SELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 11 AND "petrie_pages"."rgt" >= 12) AND ("petrie_pages".id != 7)
Processing by Petrie::PagesController#show as HTML
  Parameters: {"page"=>"locations/new-york/jobs"}
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'new-york' ORDER BY "petrie_pages"."id" ASC LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."slug" = 'jobs'[0m
Completed 200 OK in 5ms (Views: 1.4ms | ActiveRecord: 0.5ms)
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.1ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'buster' LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  UPDATE "petrie_pages" SET "title" = ?, "slug" = ?, "updated_at" = ? WHERE "petrie_pages"."id" = 1  [["title", "Buster"], ["slug", "buster"], ["updated_at", Sun, 03 Nov 2013 16:56:45 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.5ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36mPetrie::Page Exists (0.3ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.6ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:56:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 1]]
  [1m[36mSQL (0.2ms)[0m  [1mUPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")[0m
  [1m[35m (0.5ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'test-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "test-page"], ["title", "Test Page"], ["updated_at", Sun, 03 Nov 2013 16:56:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL ORDER BY "petrie_pages"."lft"[0m
  [1m[35m (0.4ms)[0m  rollback transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35m (0.1ms)[0m  commit transaction
  [1m[36m (0.1ms)[0m  [1mbegin transaction[0m
  [1m[35mPetrie::Page Exists (0.3ms)[0m  SELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" IS NULL AND "petrie_pages"."slug" = 'parent-page' LIMIT 1
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1[0m
  [1m[35mSQL (0.5ms)[0m  INSERT INTO "petrie_pages" ("created_at", "lft", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?)  [["created_at", Sun, 03 Nov 2013 16:56:46 UTC +00:00], ["lft", 1], ["rgt", 2], ["slug", "parent-page"], ["title", "Parent Page"], ["updated_at", Sun, 03 Nov 2013 16:56:46 UTC +00:00]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mSQL (0.2ms)[0m  UPDATE "petrie_pages" SET "depth" = 0 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 1 ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Exists (0.2ms)[0m  [1mSELECT 1 AS one FROM "petrie_pages" WHERE "petrie_pages"."parent_id" = 1 AND "petrie_pages"."slug" = 'child-page' LIMIT 1[0m
  [1m[35mPetrie::Page Load (0.5ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" ORDER BY "petrie_pages"."rgt" desc LIMIT 1
  [1m[36mSQL (0.3ms)[0m  [1mINSERT INTO "petrie_pages" ("created_at", "lft", "parent_id", "rgt", "slug", "title", "updated_at") VALUES (?, ?, ?, ?, ?, ?, ?)[0m  [["created_at", Sun, 03 Nov 2013 16:56:46 UTC +00:00], ["lft", 3], ["parent_id", 1], ["rgt", 4], ["slug", "child-page"], ["title", "Child Page"], ["updated_at", Sun, 03 Nov 2013 16:56:46 UTC +00:00]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."lft" LIMIT 1  [["id", 1]]
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mSQL (0.3ms)[0m  UPDATE "petrie_pages" SET "lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END, "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END, "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE (not ("lft" = CASE WHEN "lft" BETWEEN 2 AND 2 THEN "lft" + 4 - 2 WHEN "lft" BETWEEN 3 AND 4 THEN "lft" + 2 - 3 ELSE "lft" END AND "rgt" = CASE WHEN "rgt" BETWEEN 2 AND 2 THEN "rgt" + 4 - 2 WHEN "rgt" BETWEEN 3 AND 4 THEN "rgt" + 2 - 3 ELSE "rgt" END AND "parent_id" = CASE WHEN id = 2 THEN 1 ELSE "parent_id" END)) ORDER BY "petrie_pages"."lft")
  [1m[36mPetrie::Page Load (0.2ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 1]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.2ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE ("petrie_pages"."lft" >= 2 AND "petrie_pages"."lft" < 3) AND ("petrie_pages".id != 2) ORDER BY "petrie_pages"."lft"
  [1m[36mPetrie::Page Load (0.1ms)[0m  [1mSELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1[0m  [["id", 2]]
  [1m[35mPetrie::Page Load (0.1ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? LIMIT 1  [["id", 2]]
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mSQL (0.1ms)[0m  UPDATE "petrie_pages" SET "depth" = 1 WHERE "petrie_pages"."id" IN (SELECT "petrie_pages"."id" FROM "petrie_pages" WHERE "petrie_pages"."id" = 2 ORDER BY "petrie_pages"."lft")
  [1m[36m (0.1ms)[0m  [1mSELECT COUNT(*) FROM "petrie_pages" WHERE ("petrie_pages"."lft" <= 2 AND "petrie_pages"."rgt" >= 3) AND ("petrie_pages".id != 2)[0m
  [1m[35mPetrie::Page Load (0.2ms)[0m  SELECT "petrie_pages".* FROM "petrie_pages" WHERE "petrie_pages"."id" = ? ORDER BY "petrie_pages"."id" ASC LIMIT 1  [["id", 1]]
  [1m[36m (0.4ms)[0m  [1mrollback transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
  [1m[36m (0.1ms)[0m  [1mcommit transaction[0m
  [1m[35m (0.1ms)[0m  begin transaction
Started GET "/home" for 127.0.0.1 at 2013-11-03 10:56:46 -0600
  [1m[36m (0.1ms)[0m  [1mrollback transaction[0m
